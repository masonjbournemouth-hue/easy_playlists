plugins {
    id 'com.android.application'
    id 'kotlin-android'
    id 'dev.flutter.flutter-gradle-plugin'
}

android {
    namespace "com.example.playlist_city" // keep your real namespace
    compileSdk flutter.compileSdkVersion

android {
    // ...existing config...
    ndkVersion "27.0.12077973"
}

    defaultConfig {
        applicationId "com.example.playlist_city" // keep your real ID
        minSdk 21
        targetSdk flutter.targetSdkVersion
        versionCode flutter.versionCode
        versionName flutter.versionName
        multiDexEnabled true
    }

    signingConfigs {
        release {
            // Prefer key.properties when present (local builds),
            // BUT in CI we’ll override via env (see workflow below)
            def propsFile = rootProject.file("key.properties")
            if (propsFile.exists()) {
                def p = new Properties()
                p.load(new FileInputStream(propsFile))
                storeFile file(p['storeFile'])
                storePassword p['storePassword']
                keyAlias p['keyAlias']
                keyPassword p['keyPassword']
            } else {
                // CI path – uses env provided by GitHub Actions
                if (System.getenv("CI") == "true") {
                    storeFile file("$rootDir/app/release-keystore.jks")
                    storePassword System.getenv("KEYSTORE_PASSWORD")
                    keyAlias System.getenv("KEY_ALIAS")
                    keyPassword System.getenv("KEY_PASSWORD")
                }
            }
        }
    }

    buildTypes {
        release {
            signingConfig signingConfigs.release
            minifyEnabled false       // keep off until you’re ready to shrink
            shrinkResources false
        }
        debug {
            debuggable true
        }
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_11
        targetCompatibility JavaVersion.VERSION_11
    }
    kotlinOptions { jvmTarget = '11' }
}

dependencies {
    implementation 'androidx.multidex:multidex:2.0.1'
}
