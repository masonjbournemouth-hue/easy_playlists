// android/app/build.gradle  (Groovy, not KTS)
plugins {
    id 'com.android.application'
    id 'kotlin-android'
    id 'dev.flutter.flutter-gradle-plugin'
}

android {
    namespace "com.playlistcity.app"

    compileSdk 35

    defaultConfig {
        applicationId "com.playlistcity.app"
        minSdk 21
        targetSdk flutter.targetSdkVersion
        // BUMP this to a new integer each upload:
        versionCode 3
        versionName "2.3"
    }

    signingConfigs {
	release {
            def keystoreProperties = new Properties()
            def keystoreFile = rootProject.file("key.properties")
            if (keystoreFile.exists()) {
                keystoreProperties.load(new FileInputStream(keystoreFile))
                storeFile file(keystoreProperties["storeFile"])
                storePassword keystoreProperties["storePassword"]
                keyAlias keystoreProperties["keyAlias"]
                keyPassword keystoreProperties["keyPassword"]
            } else {
                println("⚠️ Warning: key.properties not found, skipping local signing")
            }
        }
    }

    buildTypes {
        release {
            if (signingConfigs.release.storeFile != null) {
                signingConfig signingConfigs.release
            }
            // Disable shrinking/obfuscation for CI simplicity
            minifyEnabled false
            shrinkResources false

            // Keep native debug symbols (avoid “failed to strip”)
            ndk {
                debugSymbolLevel 'FULL'
            }

            // Add this line ↓ to skip symbol stripping
            packagingOptions {
                doNotStrip "**/*.so"
            }

        }
        debug {
            debuggable true
        }
    }

    // Toolchains
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_11
        targetCompatibility JavaVersion.VERSION_11
    }
    kotlinOptions {
        jvmTarget = '11'
    }

    // Avoid META-INF clashes and keep .so symbols
    packagingOptions {
        jniLibs {
            keepDebugSymbols.add("**/*.so")
        }
        resources {
            excludes += ['META-INF/AL2.0', 'META-INF/LGPL2.1']
        }
    }
}

dependencies {
    implementation 'androidx.multidex:multidex:2.0.1'
}

